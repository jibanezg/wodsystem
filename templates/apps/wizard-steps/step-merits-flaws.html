<div class="wizard-step step-merits-flaws">
  <div class="step-header">
    <h3><i class="fas fa-balance-scale"></i> {{i18n 'Wizard.StepMeritsFlaws'}}</h3>
    <p class="step-description">
      {{i18n 'Wizard.MeritsFlawsDescription'}}<br>
      {{i18n 'Wizard.FlawsWithoutMeritsConvert'}}
    </p>
  </div>

  <div class="step-body">
    <div class="merits-flaws-grid">
      
      <!-- Merits Section -->
      <div class="merit-flaw-section">
        <h4>
          {{i18n 'MeritsFlaws.Merits'}}
          <span class="points-display">
            {{wizardData.meritsFlaws.meritPoints}} {{i18n 'Wizard.Points'}}
          </span>
        </h4>
        
        <div class="merit-list">
          {{#each wizardData.meritsFlaws.merits}}
          <div class="merit-flaw-item">
            <div class="name-input-container">
              <input type="text" 
                     class="wizard-merit-name" 
                     data-index="{{@index}}" 
                     value="{{this.name}}" 
                     placeholder="{{i18n 'Wizard.MeritName'}}" />
              <a class="wizard-merit-reference-btn" data-index="{{@index}}" title="{{i18n 'Wizard.ViewMeritDetails'}}">
                <i class="fas fa-book-open"></i>
              </a>
            </div>
            <div class="value-controls">
              <button type="button" class="value-decrease" data-type="merit" data-index="{{@index}}" {{#if (lte (default this.value 0) 0)}}disabled{{/if}}>
                <i class="fas fa-minus"></i>
              </button>
              <span class="value-display">{{default this.value 0}}</span>
              <button type="button" class="value-increase" data-type="merit" data-index="{{@index}}" {{#if (gte (default this.value 0) 7)}}disabled{{/if}}>
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="dots-display">
              {{{renderDots (default this.value 0) 7}}}
            </div>
            <button type="button" class="remove-item" data-type="merit" data-index="{{@index}}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          {{/each}}
          
          <button type="button" class="add-item" data-type="merit">
            <i class="fas fa-plus"></i> {{i18n 'MeritsFlaws.AddMerit'}}
          </button>
        </div>
      </div>

      <!-- Flaws Section -->
      <div class="merit-flaw-section">
        <h4>
          {{i18n 'MeritsFlaws.Flaws'}}
          <span class="points-display">
            {{wizardData.meritsFlaws.flawPoints}} {{i18n 'Wizard.Points'}}
          </span>
        </h4>
        
        <div class="flaw-list">
          {{#each wizardData.meritsFlaws.flaws}}
          <div class="merit-flaw-item">
            <div class="name-input-container">
              <input type="text" 
                     class="wizard-flaw-name" 
                     data-index="{{@index}}" 
                     value="{{this.name}}" 
                     placeholder="{{i18n 'Wizard.FlawName'}}" />
              <a class="wizard-flaw-reference-btn" data-index="{{@index}}" title="{{i18n 'Wizard.ViewFlawDetails'}}">
                <i class="fas fa-book-open"></i>
              </a>
            </div>
            <div class="value-controls">
              <button type="button" class="value-decrease" data-type="flaw" data-index="{{@index}}" {{#if (lte (default this.value 0) 0)}}disabled{{/if}}>
                <i class="fas fa-minus"></i>
              </button>
              <span class="value-display">{{default this.value 0}}</span>
              <button type="button" class="value-increase" data-type="flaw" data-index="{{@index}}" {{#if (gte (default this.value 0) 7)}}disabled{{/if}}>
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="dots-display">
              {{{renderDots (default this.value 0) 7}}}
            </div>
            <button type="button" class="remove-item" data-type="flaw" data-index="{{@index}}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          {{/each}}
          
          <button type="button" class="add-item" data-type="flaw">
            <i class="fas fa-plus"></i> {{i18n 'MeritsFlaws.AddFlaw'}}
          </button>
        </div>
      </div>
    </div>

    <!-- Balance Summary -->
    <div class="balance-summary">
      <div class="balance-row">
        <span class="label">{{i18n 'Wizard.MeritPoints'}}:</span>
        <span class="value merits-total">{{wizardData.meritsFlaws.meritPoints}}</span>
      </div>
      <div class="balance-row">
        <span class="label">{{i18n 'Wizard.FlawPoints'}}:</span>
        <span class="value flaws-total">{{wizardData.meritsFlaws.flawPoints}}</span>
      </div>
      <div class="balance-row balance-status {{#if validation.meritsFlaws.balanced}}balanced{{else}}unbalanced{{/if}}">
        <span class="label">{{i18n 'Wizard.Status'}}:</span>
        <span class="value">
          {{#if validation.meritsFlaws.balanced}}
            {{#if (gt wizardData.meritsFlaws.freebieBonus 0)}}
              <i class="fas fa-star"></i> {{wizardData.meritsFlaws.freebieBonus}} {{i18n 'Wizard.FreebiePointsGained'}}
            {{else}}
              <i class="fas fa-check-circle"></i> {{i18n 'Wizard.Balanced'}}
            {{/if}}
          {{else}}
            <i class="fas fa-exclamation-triangle"></i> {{i18n 'Wizard.NeedsMoreFlawPoints' needed=validation.meritsFlaws.needed}}
          {{/if}}
        </span>
      </div>
    </div>
  </div>
</div>

