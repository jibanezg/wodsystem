<div class="wizard-step step-attributes">
  <div class="step-header">
    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
      <div>
        <h3><i class="fas fa-dumbbell"></i> {{i18n 'Wizard.Attributes'}}</h3>
        <p class="step-description">{{i18n 'Wizard.DistributeAttributes'}}</p>
      </div>
      <button type="button" class="randomize-attributes-btn" title="{{i18n 'Wizard.RandomizeAttributes'}}">
        <i class="fas fa-dice"></i> {{i18n 'Wizard.RandomizeAttributes'}}
      </button>
    </div>
  </div>

  <div class="step-body">
    <!-- Priority Selection -->
    <div class="priority-selection">
      <h4>{{i18n 'Wizard.ChoosePriority'}}</h4>
      <p>{{i18n 'Wizard.AssignPriority' primary=config.attributes.priorities.primary secondary=config.attributes.priorities.secondary tertiary=config.attributes.priorities.tertiary}}</p>
      
      <div class="priority-grid">
        {{#each config.attributes.categories}}
        <div class="priority-item">
          <label>{{capitalize this}}</label>
          <select class="priority-select" data-category="{{this}}">
            <option value="">{{i18n 'Wizard.SelectLabel'}}</option>
            <option value="primary" {{#if (eq (lookup ../../wizardData.attributes.prioritySelection "primary") this)}}selected{{/if}}>
              {{i18n 'Wizard.Primary'}} ({{../config.attributes.priorities.primary}} {{i18n 'Wizard.Points'}})
            </option>
            <option value="secondary" {{#if (eq (lookup ../../wizardData.attributes.prioritySelection "secondary") this)}}selected{{/if}}>
              {{i18n 'Wizard.Secondary'}} ({{../config.attributes.priorities.secondary}} {{i18n 'Wizard.Points'}})
            </option>
            <option value="tertiary" {{#if (eq (lookup ../../wizardData.attributes.prioritySelection "tertiary") this)}}selected{{/if}}>
              {{i18n 'Wizard.Tertiary'}} ({{../config.attributes.priorities.tertiary}} {{i18n 'Wizard.Points'}})
            </option>
          </select>
        </div>
        {{/each}}
      </div>
    </div>

    <!-- Attribute Distribution -->
    <div class="attributes-distribution">
      <!-- Physical Attributes -->
      <div class="attribute-category">
        <h4>{{i18n 'Wizard.PhysicalAttributes'}}</h4>
        
        {{#if validation.attributes.physical}}
        <div class="points-tracker">
          <span class="spent">{{validation.attributes.physical.spent}}</span> / 
          <span class="allowed">{{validation.attributes.physical.allowed}}</span> {{i18n 'Wizard.PointsSpent'}}
          {{#if (gt validation.attributes.physical.remaining 0)}}
          <span class="remaining">({{validation.attributes.physical.remaining}} {{i18n 'Wizard.Remaining'}})</span>
          {{/if}}
        </div>
        
        <div class="attribute-list">
          {{#each wizardData.attributes.values.physical}}
          <div class="attribute-item">
            <span class="attr-name">{{@key}}</span>
            <div class="attr-controls">
              <button type="button" 
                      class="attr-decrease" 
                      data-category="physical" 
                      data-attr="{{@key}}"
                      {{#if (eq this 1)}}disabled{{/if}}>
                <i class="fas fa-minus"></i>
              </button>
              <span class="attr-value">{{this}}</span>
              <button type="button" 
                      class="attr-increase" 
                      data-category="physical" 
                      data-attr="{{@key}}"
                      {{#if (eq this 5)}}disabled{{/if}}>
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="attr-dots">
              {{{renderDots this 5}}}
            </div>
          </div>
          {{/each}}
        </div>
        {{/if}}
      </div>

      <!-- Social Attributes -->
      <div class="attribute-category">
        <h4>{{i18n 'Wizard.SocialAttributes'}}</h4>
        
        {{#if validation.attributes.social}}
        <div class="points-tracker">
          <span class="spent">{{validation.attributes.social.spent}}</span> / 
          <span class="allowed">{{validation.attributes.social.allowed}}</span> {{i18n 'Wizard.PointsSpent'}}
          {{#if (gt validation.attributes.social.remaining 0)}}
          <span class="remaining">({{validation.attributes.social.remaining}} {{i18n 'Wizard.Remaining'}})</span>
          {{/if}}
        </div>
        
        <div class="attribute-list">
          {{#each wizardData.attributes.values.social}}
          <div class="attribute-item">
            <span class="attr-name">{{@key}}</span>
            <div class="attr-controls">
              <button type="button" 
                      class="attr-decrease" 
                      data-category="social" 
                      data-attr="{{@key}}"
                      {{#if (eq this 1)}}disabled{{/if}}>
                <i class="fas fa-minus"></i>
              </button>
              <span class="attr-value">{{this}}</span>
              <button type="button" 
                      class="attr-increase" 
                      data-category="social" 
                      data-attr="{{@key}}"
                      {{#if (eq this 5)}}disabled{{/if}}>
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="attr-dots">
              {{{renderDots this 5}}}
            </div>
          </div>
          {{/each}}
        </div>
        {{/if}}
      </div>

      <!-- Mental Attributes -->
      <div class="attribute-category">
        <h4>{{i18n 'Wizard.MentalAttributes'}}</h4>
        
        {{#if validation.attributes.mental}}
        <div class="points-tracker">
          <span class="spent">{{validation.attributes.mental.spent}}</span> / 
          <span class="allowed">{{validation.attributes.mental.allowed}}</span> {{i18n 'Wizard.PointsSpent'}}
          {{#if (gt validation.attributes.mental.remaining 0)}}
          <span class="remaining">({{validation.attributes.mental.remaining}} {{i18n 'Wizard.Remaining'}})</span>
          {{/if}}
        </div>
        
        <div class="attribute-list">
          {{#each wizardData.attributes.values.mental}}
          <div class="attribute-item">
            <span class="attr-name">{{@key}}</span>
            <div class="attr-controls">
              <button type="button" 
                      class="attr-decrease" 
                      data-category="mental" 
                      data-attr="{{@key}}"
                      {{#if (eq this 1)}}disabled{{/if}}>
                <i class="fas fa-minus"></i>
              </button>
              <span class="attr-value">{{this}}</span>
              <button type="button" 
                      class="attr-increase" 
                      data-category="mental" 
                      data-attr="{{@key}}"
                      {{#if (eq this 5)}}disabled{{/if}}>
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="attr-dots">
              {{{renderDots this 5}}}
            </div>
          </div>
          {{/each}}
        </div>
        {{/if}}
      </div>
    </div>
  </div>

  <div class="step-help">
    <div class="help-box">
      <h4><i class="fas fa-lightbulb"></i> {{i18n 'Wizard.AttributeGuide'}}</h4>
      <ul>
        <li><strong>{{i18n 'Attributes.Physical'}}:</strong> {{i18n 'Wizard.PhysicalDesc'}}</li>
        <li><strong>{{i18n 'Attributes.Social'}}:</strong> {{i18n 'Wizard.SocialDesc'}}</li>
        <li><strong>{{i18n 'Attributes.Mental'}}:</strong> {{i18n 'Wizard.MentalDesc'}}</li>
        <li>{{i18n 'Wizard.AllStartAt1'}}</li>
        <li>{{i18n 'Wizard.MustSpendAll'}}</li>
      </ul>
    </div>
  </div>
</div>

