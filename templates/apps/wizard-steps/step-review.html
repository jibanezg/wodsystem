<div class="wizard-step step-review">
  <div class="step-header">
    <h3><i class="fas fa-check-circle"></i> {{i18n 'Wizard.ReviewCharacter'}}</h3>
    <p class="step-description">{{i18n 'Wizard.ReviewBeforeFinalizing'}}</p>
  </div>

  <div class="step-body">
    <div class="review-grid">
      
      <!-- Concept -->
      <div class="review-section">
        <h4><i class="fas fa-user"></i> {{i18n 'Wizard.Concept'}}
          <button type="button" class="review-edit-step" data-step="0"><i class="fas fa-edit"></i></button>
        </h4>
        <div class="review-content">
          <div class="review-row"><strong>{{i18n 'Wizard.Name'}}:</strong> {{wizardData.concept.name}}</div>
          <div class="review-row"><strong>{{i18n 'Wizard.Concept'}}:</strong> {{wizardData.concept.concept}}</div>
          <div class="review-row"><strong>{{i18n 'Wizard.Nature'}}:</strong> {{wizardData.concept.nature}}</div>
          <div class="review-row"><strong>{{i18n 'Wizard.Demeanor'}}:</strong> {{wizardData.concept.demeanor}}</div>
          {{#if (eq actorType "Technocrat")}}
          <div class="review-row"><strong>{{i18n 'Wizard.Convention'}}:</strong> {{wizardData.concept.convention}}</div>
          {{#if wizardData.concept.amalgam}}
          <div class="review-row"><strong>{{i18n 'Wizard.Amalgam'}}:</strong> {{wizardData.concept.amalgam}}</div>
          {{/if}}
          {{/if}}
        </div>
      </div>

      <!-- Attributes -->
      <div class="review-section">
        <h4><i class="fas fa-dumbbell"></i> {{i18n 'Wizard.Attributes'}}
          <button type="button" class="review-edit-step" data-step="1"><i class="fas fa-edit"></i></button>
        </h4>
        <div class="review-content attributes-review">
          {{#each wizardData.attributes.values}}
          <div class="attribute-category">
            <h5>{{capitalize @key}}</h5>
            {{#each this}}
            <div class="review-row">
              <span>{{@key}}</span>
              <span class="dots">
                {{{renderDots this 5}}}
              </span>
            </div>
            {{/each}}
          </div>
          {{/each}}
        </div>
      </div>

      <!-- Abilities -->
      <div class="review-section">
        <h4><i class="fas fa-brain"></i> {{i18n 'Wizard.Abilities'}}
          <button type="button" class="review-edit-step" data-step="2"><i class="fas fa-edit"></i></button>
        </h4>
        <div class="review-content abilities-review">
          {{#each wizardData.abilities.values}}
          {{#if (hasRatedAbilities this)}}
          <div class="ability-category">
            <h5>{{capitalize @key}}</h5>
            {{#each this}}
            {{#if (gt this 0)}}
            <div class="review-row">
              <span>{{@key}}</span>
              <span class="dots">
                {{{renderDots this 5}}}
              </span>
            </div>
            {{/if}}
            {{/each}}
          </div>
          {{/if}}
          {{/each}}
          
          <!-- Secondary Abilities -->
          {{#each wizardData.abilities.secondary}}
          {{#if this.length}}
          <div class="ability-category secondary">
            <h5>{{i18n 'Wizard.Custom'}} {{capitalize @key}}</h5>
            {{#each this}}
            <div class="review-row">
              <span>{{name}}</span>
              <span class="dots">
                {{{renderDots value 5}}}
              </span>
            </div>
            {{/each}}
          </div>
          {{/if}}
          {{/each}}
        </div>
      </div>

      <!-- Advantages -->
      <div class="review-section">
        <h4><i class="fas fa-star"></i> {{i18n 'Wizard.Advantages'}}
          <button type="button" class="review-edit-step" data-step="3"><i class="fas fa-edit"></i></button>
        </h4>
        <div class="review-content">
          
          <!-- Backgrounds -->
          <div class="advantage-subsection">
            <h5>{{i18n 'Advantages.Backgrounds'}}</h5>
            {{#each wizardData.advantages.backgrounds}}
            {{#if (gt value 0)}}
            <div class="review-row">
              <span>{{name}}</span>
              <span class="dots">
                {{{renderDots value 5}}}
              </span>
            </div>
            {{/if}}
            {{/each}}
          </div>

          <!-- Spheres (Technocrat) -->
          {{#if (eq actorType "Technocrat")}}
          <div class="advantage-subsection">
            <h5>{{i18n 'Spheres.Spheres'}}</h5>
            {{#each wizardData.advantages.spheres}}
            {{#if (gt this 0)}}
            <div class="review-row">
              <span>{{lookup @root.config.advantages.spheres.available @key}}</span>
              <span class="dots">
                {{{renderDots this (default @root.wizardData.advantages.enlightenment @root.config.advantages.enlightenment.starting)}}}
              </span>
            </div>
            {{/if}}
            {{/each}}
          </div>

          <!-- Enlightenment -->
          <div class="advantage-subsection">
            <h5>{{i18n 'Advantages.Enlightenment'}}</h5>
            <div class="review-row">
              <span>{{i18n 'Advantages.Enlightenment'}}</span>
              <span class="value">{{default wizardData.advantages.enlightenment config.advantages.enlightenment.starting}}</span>
            </div>
          </div>
          {{/if}}

          <!-- Willpower -->
          <div class="advantage-subsection">
            <h5>{{i18n 'Advantages.Willpower'}}</h5>
            <div class="review-row">
              <span>{{i18n 'Advantages.Willpower'}}</span>
              <span class="value">{{add config.advantages.willpower.starting (default wizardData.freebies.spent.willpower 0)}}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Freebie Points -->
      <div class="review-section">
        <h4><i class="fas fa-coins"></i> {{i18n 'Wizard.Freebies'}}
          <button type="button" class="review-edit-step" data-step="4"><i class="fas fa-edit"></i></button>
        </h4>
        <div class="review-content">
          <div class="review-row">
            <strong>{{i18n 'Wizard.Total'}}:</strong> {{config.freebies.total}} {{i18n 'Wizard.Points'}}
          </div>
          <div class="review-row">
            <strong>{{i18n 'Wizard.Spent'}}:</strong> {{sub config.freebies.total wizardData.freebies.remaining}} {{i18n 'Wizard.Points'}}
          </div>
          <div class="review-row {{#if (gt wizardData.freebies.remaining 0)}}unspent{{/if}}">
            <strong>{{i18n 'Common.Remaining'}}:</strong> {{wizardData.freebies.remaining}} {{i18n 'Wizard.Points'}}
          </div>
        </div>
      </div>

    </div>

    <div class="review-summary">
      <h4>{{i18n 'Wizard.CharacterSummary'}}</h4>
      <p class="summary-text">
        <strong>{{wizardData.concept.name}}</strong>, {{i18n 'Wizard.A'}} <em>{{wizardData.concept.concept}}</em>.
        {{#if (eq actorType "Technocrat")}}
        {{i18n 'Wizard.MemberOf'}} <strong>{{wizardData.concept.convention}}</strong>{{#if wizardData.concept.amalgam}} ({{wizardData.concept.amalgam}}){{/if}}.
        {{/if}}
        {{wizardData.concept.nature}} {{i18n 'Wizard.ByNature'}} {{wizardData.concept.demeanor}} {{i18n 'Wizard.ToOthers'}}.
      </p>
      
      {{#if (gt wizardData.freebies.remaining 0)}}
      <div class="warning-box">
        <i class="fas fa-exclamation-triangle"></i>
        {{i18n 'Wizard.UnspentFreebiePoints' remaining=wizardData.freebies.remaining}}
      </div>
      {{/if}}
      
      <div class="final-confirmation">
        <p><strong>{{i18n 'Wizard.ReadyToFinalize'}}</strong></p>
        <p>{{i18n 'Wizard.ClickFinishToApply'}}</p>
      </div>
    </div>
  </div>
</div>

