<div class="wizard-step step-abilities">
  <div class="step-header">
    <h3><i class="fas fa-brain"></i> {{i18n 'Wizard.Abilities'}}</h3>
    <p class="step-description">{{i18n 'Wizard.DistributeAbilities'}}</p>
  </div>

  <div class="step-body">
    <!-- Priority Selection -->
    <div class="priority-selection">
      <h4>{{i18n 'Wizard.ChoosePriority'}}</h4>
      <p>{{i18n 'Wizard.AssignPriority' primary=config.abilities.priorities.primary secondary=config.abilities.priorities.secondary tertiary=config.abilities.priorities.tertiary}}</p>
      
      <div class="priority-grid">
        {{#each config.abilities.categories}}
        <div class="priority-item">
          <label>{{capitalize this}}</label>
          <select class="priority-select" data-category="{{this}}">
            <option value="">{{i18n 'Wizard.SelectLabel'}}</option>
            <option value="primary" {{#if (eq (lookup ../wizardData.abilities.prioritySelection "primary") this)}}selected{{/if}}>
              {{i18n 'Wizard.Primary'}} ({{../config.abilities.priorities.primary}} {{i18n 'Wizard.Points'}})
            </option>
            <option value="secondary" {{#if (eq (lookup ../wizardData.abilities.prioritySelection "secondary") this)}}selected{{/if}}>
              {{i18n 'Wizard.Secondary'}} ({{../config.abilities.priorities.secondary}} {{i18n 'Wizard.Points'}})
            </option>
            <option value="tertiary" {{#if (eq (lookup ../wizardData.abilities.prioritySelection "tertiary") this)}}selected{{/if}}>
              {{i18n 'Wizard.Tertiary'}} ({{../config.abilities.priorities.tertiary}} {{i18n 'Wizard.Points'}})
            </option>
          </select>
        </div>
        {{/each}}
      </div>
    </div>

    <!-- Abilities Distribution -->
    <div class="abilities-distribution">
      {{#each config.abilities.categories}}
      {{#with (lookup ../validation.abilities this) as |categoryValidation|}}
      {{#if categoryValidation}}
      <div class="ability-category" data-category="{{../this}}">
        <h4>{{capitalize ../this}}</h4>
        
        <div class="points-tracker">
          <span class="spent">{{categoryValidation.spent}}</span> / 
          <span class="allowed">{{categoryValidation.allowed}}</span> {{i18n 'Wizard.PointsSpent'}}
          {{#if (gt categoryValidation.remaining 0)}}
          <span class="remaining">({{categoryValidation.remaining}} {{i18n 'Wizard.Remaining'}})</span>
          {{/if}}
        </div>
        
        <!-- Primary Abilities -->
        <div class="ability-list">
          {{#each (lookup ../../wizardData.abilities.values ../this)}}
          <div class="ability-item">
            <span class="ability-name">{{@key}}</span>
            <div class="ability-controls">
              <button type="button" 
                      class="ability-decrease" 
                      data-category="{{../../this}}" 
                      data-ability="{{@key}}"
                      {{#if (eq this 0)}}disabled{{/if}}>
                <i class="fas fa-minus"></i>
              </button>
              <span class="ability-value">{{this}}</span>
              <button type="button" 
                      class="ability-increase" 
                      data-category="{{../../this}}" 
                      data-ability="{{@key}}"
                      {{#if (eq this ../../../config.abilities.maxAtCreation)}}disabled{{/if}}>
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="ability-dots">
              {{{renderDots this ../../../config.abilities.maxAtCreation}}}
            </div>
          </div>
          {{/each}}
        </div>

        <!-- Secondary Abilities -->
        {{#if ../../config.abilities.allowSecondary}}
        <div class="secondary-abilities" data-category="{{../this}}">
          <h5>{{i18n 'Wizard.Custom'}} {{capitalize ../this}}</h5>
          {{#each (lookup ../../wizardData.abilities.secondary ../this)}}
          <div class="ability-item secondary" data-index="{{@index}}">
            <input type="text" 
                   class="ability-name-input" 
                   value="{{name}}" 
                   placeholder="{{i18n 'Wizard.AbilityName'}}">
            <div class="ability-controls">
              <button type="button" class="ability-decrease" data-index="{{@index}}" {{#if (eq value 0)}}disabled{{/if}}>
                <i class="fas fa-minus"></i>
              </button>
              <span class="ability-value">{{value}}</span>
              <button type="button" class="ability-increase" data-index="{{@index}}" {{#if (eq value ../../../config.abilities.maxAtCreation)}}disabled{{/if}}>
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="ability-dots">
              {{{renderDots value ../../../config.abilities.maxAtCreation}}}
            </div>
          </div>
          {{/each}}
          <button type="button" class="add-secondary" data-category="{{../this}}">
            <i class="fas fa-plus"></i> {{i18n 'Wizard.AddCustom'}} {{capitalize ../this}}
          </button>
        </div>
        {{/if}}
        
      </div>
      {{/if}}
      {{/with}}
      {{/each}}
    </div>
  </div>

  <div class="step-help">
    <div class="help-box">
      <h4><i class="fas fa-lightbulb"></i> {{i18n 'Wizard.AbilityGuide'}}</h4>
      <ul>
        <li><strong>{{i18n 'Abilities.Talents'}}:</strong> {{i18n 'Wizard.TalentsDesc'}}</li>
        <li><strong>{{i18n 'Abilities.Skills'}}:</strong> {{i18n 'Wizard.SkillsDesc'}}</li>
        <li><strong>{{i18n 'Abilities.Knowledges'}}:</strong> {{i18n 'Wizard.KnowledgesDesc'}}</li>
        <li>{{i18n 'Wizard.MaxAtCreation' max=config.abilities.maxAtCreation}}</li>
        <li>{{i18n 'Wizard.MustSpendAll'}}</li>
        <li>{{i18n 'Wizard.CanAddCustom'}}</li>
      </ul>
    </div>
  </div>
</div>

