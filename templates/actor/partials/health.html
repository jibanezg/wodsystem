<!-- Health Section with Damage Types -->
<div class="health-section">
    <h2>{{i18n 'WODSYSTEM.CharacterSheet.Sections.Health'}}</h2>
    
    {{#if isHealthEditMode}}
        <!-- EDIT MODE: Show editable fields -->
        <div class="health-edit-mode">
            {{#each actor.system.miscellaneous.health.levels as |level|}}
            <div class="health-level-edit">
                <input type="text" 
                       class="health-name-edit" 
                       value="{{level.name}}" 
                       data-index="{{level.index}}"
                       placeholder="{{i18n 'WODSYSTEM.CharacterSheet.Health.LevelName'}}">
                <input type="number" 
                       class="health-penalty-edit" 
                       value="{{level.penalty}}" 
                       data-index="{{level.index}}"
                       placeholder="{{i18n 'WODSYSTEM.CharacterSheet.Health.Penalty'}}">
                <button class="delete-health-level" 
                        type="button" 
                        data-index="{{level.index}}"
                        title="{{i18n 'WODSYSTEM.CharacterSheet.Health.DeleteThisHealthLevel'}}">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            {{/each}}
            <div class="health-edit-controls">
                <button class="add-health-level" type="button" title="{{i18n 'WODSYSTEM.CharacterSheet.Health.AddNewHealthLevel'}}">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="toggle-health-edit" type="button" title="{{i18n 'WODSYSTEM.CharacterSheet.Health.SaveAndExitEditMode'}}">
                    <i class="fas fa-check"></i>
                </button>
            </div>
        </div>
    {{else}}
        <!-- VIEW MODE: Current display with damage tracking -->
        
        <!-- Damage Type Buttons -->
        <div class="health-damage-buttons">
            <button class="damage-btn bashing-btn" type="button" data-damage-type="bashing" title="{{i18n 'WODSYSTEM.CharacterSheet.Health.AddBashingDamage'}}">
                <i class="fas fa-fist-raised"></i> B
            </button>
            <button class="damage-btn lethal-btn" type="button" data-damage-type="lethal" title="{{i18n 'WODSYSTEM.CharacterSheet.Health.AddLethalDamage'}}">
                <i class="fas fa-bolt"></i> L
            </button>
            <button class="damage-btn aggravated-btn" type="button" data-damage-type="aggravated" title="{{i18n 'WODSYSTEM.CharacterSheet.Health.AddAggravatedDamage'}}">
                <i class="fas fa-skull"></i> A
            </button>
        </div>
        
        <div class="health-track">
            {{#each actor.system.miscellaneous.health.levels as |level|}}
            <div class="health-level">
                <div class="health-box {{#if level.marked}}marked damage-{{level.damageType}}{{/if}}" 
                     data-index="{{level.index}}"
                     title="{{i18n 'WODSYSTEM.CharacterSheet.Health.RightClickToHeal'}}">
                </div>
                <span class="health-name">{{translateHealthLevel level.name}}</span>
                <span class="health-penalty">
                    {{#if (lt level.penalty 0)}}
                        {{level.penalty}}
                    {{else if (eq level.index 6)}}
                        {{i18n 'WODSYSTEM.CharacterSheet.Health.Incap'}}
                    {{/if}}
                </span>
            </div>
            {{/each}}
        </div>
        
        <!-- Health Summary -->
        <div class="health-summary">
            <div class="health-stat">
                <label>{{i18n 'WODSYSTEM.CharacterSheet.Health.Penalty'}}:</label>
                <span class="penalty-value">{{actor.system.miscellaneous.health.derived.currentPenalty}}</span>
            </div>
            <div class="health-stat">
                <label>{{i18n 'WODSYSTEM.CharacterSheet.Health.Bashing'}}:</label>
                <span>{{actor.system.miscellaneous.health.derived.bashingDamage}}</span>
            </div>
            <div class="health-stat">
                <label>{{i18n 'WODSYSTEM.CharacterSheet.Health.Lethal'}}:</label>
                <span>{{actor.system.miscellaneous.health.derived.lethalDamage}}</span>
            </div>
            <div class="health-stat">
                <label>{{i18n 'WODSYSTEM.CharacterSheet.Health.Aggravated'}}:</label>
                <span>{{actor.system.miscellaneous.health.derived.aggravatedDamage}}</span>
            </div>
        </div>
        
        <div class="health-view-controls">
            <button class="toggle-health-edit" type="button" title="{{i18n 'WODSYSTEM.CharacterSheet.Health.EditHealthLevels'}}">
                <i class="fas fa-edit"></i>
            </button>
            <button class="reset-health" type="button" title="{{i18n 'WODSYSTEM.CharacterSheet.Health.ClearAllDamage'}}">
                <i class="fas fa-redo"></i>
            </button>
        </div>
    {{/if}}
</div>
